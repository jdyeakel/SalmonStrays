\documentclass[twocolumn,preprintnumbers,amsmath,amssymb,superscriptaddress]{revtex4}
%\usepackage[pdftex]{graphicx}

\usepackage{amsmath,amsfonts,amssymb}
\usepackage[english]{babel}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{color}
\usepackage{float}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{stmaryrd}
\usepackage{anyfontsize}

\usepackage[font={small}]{caption}
\usepackage{subcaption}
\captionsetup{compatibility=false}

%\usepackage{epstopdf}
%\usepackage{array}
%\usepackage{tabularx}
%\usepackage{multirow}
\usepackage{color}
%\usepackage{multibox}
%\usepackage{rotating}
%\usepackage{lineno}
%\usepackage[left]{lineno}
%\usepackage[comma,sort&compress]{natbib}
%\usepackage{authblk}
%\usepackage{multicol}

%\bibliographystyle{ieeetr}


%\linenumbers
%\setlength\linenumbersep{3pt}

\begin{document}


%\title{Simple rules yield complex communities: deconstructed species interactions and the assembly of communities}
%\title{Community assembly and dynamics by the deconstruction of species interactions}
\title{Eco-evolutionary model of salmon straying in a metapopulation (but with a cool title)}
%\author{Justin D. Yeakel${}^{1,2,*}$, Christopher P. Kempes${}^{2}$, \& Sidney Redner${}^{2,3}$ \\ \\
%${}^1$School of Natural Science, University of California Merced, Merced, CA \\
%${}^2$The Santa Fe Institute, Santa Fe, NM \\
%${}^3$Department of Physics, Boston University, Boston MA \\
%${}^*$To whom correspondence should be addressed: jdyeakel@gmail.com
%}



\maketitle



\section*{Introduction}


%Motivation: straying
The ability of species to follow specific migratory pathways, and in the case of many salmonids to return to their natal streams after years at sea, is among the most celebrated processes observed in the natural world (REFS).
That individuals do not always follow these paths has long been appreciated (REFS), however only recently have the mechanisms governing `straying' behaviors been systemically investigated (REFS).
Although the straying of individuals into sites hosting other populations provides connections within the larger metapopulation, potentially promoting ecological rescue, it also serves to introduce maladapted individuals into habitats that are host to different environmental conditions, and this may lower the mean fitness of the local (mixed) population.


%The tradeoff
These contrasting effects integrate the ecological dynamics of connected populations as well as the evolutionary dynamics of mixed trait distributions that respond to alternative local conditions.
Population-level biodiversity is recognized to increase species persistence (REFS), and the resilience and sustainability of highly diverse systems such as the Bristol Bay sockeye populations stand in marked contrast to the comparatively homogeneous chinook salmon of California's Central Valley \cite{Anonymous:2014ku,Satterthwaite:2015ge}.
Such diversity (or lack thereof) can manifest itself by way of asynchronous population dynamics, where the drivers that give rise to changes in population size vary across a metapopulation, decreasing the potential for synchronization, and correspondingly increasing the potential for ecological rescue (REFS).
This statistical buffer against extinction has traditionally been quantified as the Portfolio Effect (PE), which is the ratio of the population CV to the CV of the aggregated metapopulation.
A second measure of diversity can be quantified as genetic variability among populations, where homogenous stocks are more likely to have similar life-history structures (REFS), be at greater risk disease-induced epidemics (REFS), and recruit sub-optimally in heterogeneous environments (REFS).
Of course, these two measures of diversity are tightly coupled: for instance, lower genetic diversity increases the likelihood that two populations respond similarly to the same stressors, and this promotes synchronized dynamics, thus lowering portfolio effects.

%Eco-evolutionary dynamics in space
%% From geographic mosaic of coevolution to...
That evolutionary forces play out heterogeneously across geographic mosaics is now a foundational concept in ecology and evolutionary biology (REFS).
These mosaics are in part driven by environmental differences between habitats that alter the selective forces acting on different phenotypes (REFS), and a principle underlying assumption is that there is gene flow such that individuals from different habitats mix over space (REFS).
Although the evolutionary outcomes of these spatial processes have been explored in depth (REFS), it is less well understood how selective mosaics and their consequent evolutionary forces impact population dynamics over ecological timescales.
How the ecological dynamics of phenotypically diverse metapopulations, wherein constituent populations are subject to different selective regimes, are altered affected by evolutionary forces is less well known. % and the subject of this paper.

%Movement through space (link back to straying)
Migratory populations that return to a breeding ground or natal stream to reproduce are linked to each other by some proportion of the population that stray into the `wrong' site; we might say that there is a \emph{Kevin} in every school or flock (Fig. \ref{fig:xkcd}).
The rate at which individuals stray, $m$, has been subject to a growing amount of both theoretical and empirical research (REFS) and may be linked to errors made at an individual-level that are themselves diminished by larger collections of individuals (REFS).
Regardless of the mechanism behind straying, the effect that it has on the dynamics of individual populations and the metapopulation as a whole is a topic of considerable interest that has tangible conservation implications (REFS).
Whether and to what extent the ecological consequences of straying depend on the evolutionary dynamics that emerge from populations distributed across a selection mosaic is unknown.
How the assumed negative evolutionary effects of straying is balanced by the positive effects of ecological rescue is the subject of this contribution.

%Here we show: pattern formation, dependence on heritability, large effects of small amounts of straying

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{figs/fig_xkcd.png}
\caption{
\emph{Migrating Geese}, a comic from Randall Monroe's xkcd (https://xkcd.com/1729/). 
A flock of geese travel in the direction of a shared destination, the lone stray named \emph{Kevin}.
In this case, the rate of straying is $m=0.05$, which is not an uncommon rate for migrating populations of salmon \cite{Satterthwaite:2015ge}. 
Reprinted under the Creative Commons Attribution-NonCommercial 2.5 License.
} \label{fig:xkcd}
\end{figure}

%Alternative stable state
Here we investigate a minimal eco-evolutionary model of two populations occupying different sites that are linked by straying, each of which with an associated trait distribution subject to natural selection determined by local conditions.
An important component of this model is the inclusion of a parameter that defines the difference in local conditions that favor different trait optima, increasing values of which correlates to populations that mix across increasingly heterogeneous environments.
Although our proposed model is most appropriate for modeling the dynamics of salmon populations, the framework is general and the conclusions are likely relevant to a diverse range of organisms where locally adapted populations are linked by migration.
We first show that specific rates of straying and trait heritability can have large effects on the qualitative dynamics of populations over time, in many cases giving rise to alternative steady states where one site is pushed towards very low biomass.
The emergence of alternative steady states results in a nonlinear response of the portfolio effect, suggesting that metapopulation persistence can be quite sensitive to the combined influences of straying and selective mosaics.

%Habitat heterogeneity
A second important finding of our minimal model reveals that systems with greater habitat heterogeneity (measured by an increased difference in the trait values that are optimal between sites) host an intermediate range of straying rates where the portfolio effect increases to a local maximum, signaling that under certain conditions moderate amounts of straying between populations can increase the likelihood of persistence despite the deleterious evolutionary effects overall.
However, if we suppose that the rate of straying between two sites is correlated with distance, and that the difference in trait optima increases with distance as would be the case if the optima were associated with alternative temperature regimes (especially if sites are distributed latitudinally rather than longitudinally), even a very small amount of straying can drastically reduce the portfolio effect.
Importantly, the qualitative nature of our results do not depend on whether the stray rate is density dependent or constant.

%Concluding paragraph of the intro




\section*{Model Description}

Here we consider two populations $N_1$ and $N_2$ that are separated in space, each with trait values $x_1$ and $x_2$ determining recruitment rates.
We assume that there is an optimum trait value $\theta_1$ and $\theta_2$ associated with each habitat, where recruitment is maximized if the trait value of the local population $x = \theta$.
Moreover, we assume that $x_{1,2}$ are normally distributed with means $\mu_1$ and $\mu_2$ and have a shared standard deviation $\sigma$.
As such, the recruitment rate for both populations is determined by the mean trait value of the local population, such that $r_1 = R_1[\mu_1(t)|\theta_1]$.
Trait means for each population are subject to selection, the strength of which depends on the difference between the population mean and the local trait optimum at a given point in time.

The two populations are assumed to reproduce in spatially separate sites that are close enough such that a proportion of the population $m$ can stray into the wrong site, and where mortality occurs before individuals return to spawn.
If there is no straying between these populations (such that they are independent), then the mean trait evolves towards the optimal value such that $x_1 \rightarrow \theta_1$, and the recruitment rate for that population will be maximized.
If there is straying between populations at rate $m$, then the traits in each respective location will be pulled away from the optimum, and recruitment rates will be lowered.
As $m \rightarrow 0.5$, the populations are perfectly mixed, acting as a single population.

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{figs/fig_Density.pdf}
\caption{
A) The steady state densities of $N_1$ and $N_2$ as a function of a constant stray rate $m$.
B) The steady state trait values measured as $theta_i - x_i$, as a function of a constant stray rate $m$. 
} \label{fig:traj}
\end{figure}

We use the discrete Ricker population dynamic framework described by Shelton and Mangel \cite{} as the basis for our two-site model, with the added effect of the local population $N_i$ mixing with a set proportion $m$ of a remote population $N_j$ that is straying into it.
We first assume that the proportion ${\rm e}^{-Z}$ of both populations survive, and that the aggregated mix of the populations (local individuals in addition to the straying individuals) are subject to the same compensatory effects, determined by the parameter $\beta$.
For a local site $i\in(1,2)$ that collects straying individuals from a remote site $j\in(1,2)$, if $N_i$ is the local site and $N_j$ is the remote site, the difference equation that determine changes in population size is

\begin{align}
  &N_i(t+1) = \\ \nonumber
  &\left((1-m)N_i(t) + m N_j(t) \right){\rm e}^{-Z} \\ \nonumber
  &+ \left(R_i[\mu_i(t)|\theta_i] (1-m)N_i(t) + R_i[\mu_j(t)|\theta_i] m N_j(t)\right) \\ \nonumber
  &\times {\rm e}^{-\beta ((1-m)N_i(t) + m N_j(t))},
  \label{eq:N}
\end{align}

\noindent where a small amount of demographic process error is added to the reproductive rate, and where the difference equation for $N_j$ mirrors that for $N_i$.

The combined recruitment of local individuals $(1-m)N_i(t)$ and incoming strays $mN_j(t)$, as a function of their mean trait value at time $t$ and given the local trait optimum $\theta_i$, is then

\begin{align}
  &R_i[\mu_i(t)|\theta_i] = \\ \nonumber
  &\int_{-\infty}^\infty r_{\rm max}\exp\left\{\frac{(x_i(t)-\theta_i)^2}{2\tau^2}\right\} {\rm pr}(x_i(t)|\mu_i,\sigma^2) {\rm d}x_i(t) \\ \nonumber
  &= \frac{r_{\rm max} \tau  }{\sqrt{\sigma ^2+\tau ^2}}\exp\left\{-\frac{(\theta_i-\mu_i(t))^2}{2 \left(\sigma ^2+\tau ^2\right)}\right\}.
  \label{eq:R}
\end{align}

\noindent As stated previously, it is the mismatch between the local trait mean $\mu_i(t)$ and the local optimum $\theta_i$ that determines the recruitment rate for the population.
The parameter $\tau$ controls the sensitivity of recruitment to changes in the mean trait value away from the optimum, which we set as $\tau=1$ here and throughout.
% The compensatory effects are then determined by the exponential, following the Ricker stock-recruitment relationship.

\begin{figure*}
\centering
\includegraphics[width=0.8\textwidth]{figs/fig_MDPE_hm.pdf}
\caption{
Total means $N_t$, difference in means $\Delta N$, and the portfolio effect PE as a function of heritability $h^2$ and a constant stray rate $m$. Light colors = high values.
} \label{fig:PE}
\end{figure*}

Because individuals from the local population are mixed with individuals from the remote population via staying, the resulting trait distribution is a mixed normal with weights corresponding to the proportion of the mixed population that are local individuals, $w_i$, and for the straying individuals, $1-w_i$, where 
\begin{equation}
w_i=\frac{(1-m)N_i(t)}{(1-m) N_i(t) + m N_j(t)}.
\end{equation}
We make two simplifying assumptions.
First, we assume that the distribution resulting from the mix of remote and local individuals, following reproduction, is also normal with a mean value being that of the mixed-normal.
Second, we assume that changes in trait variance through time are minimal, such that $\sigma$ is assumed to be constant.



An increasing flow of incoming strays is thus expected to pull the mean trait value of the local population away from its optimum, which will decrease its rate of recruitment.
The mean trait value thus changes through time according to the difference equation

\begin{align}
  \mu_i(t+1) &= w_i\mu_i(t) + (1-w_i)\mu_j(t) \\ \nonumber
  &+ \frac{\partial}{\partial \mu_i}\ln\left(w_i R_i[\mu_i(t)|\theta_i] + (1-w_i)R_i[\mu_j(t)|\theta_i]  \right),
  \label{eq:mu}
\end{align}

\noindent where the first two factors determine the mixed normal average of the now-mixed local and remote populations.
This mixed normal is weighted by the proportion of the population that is local and remote, respectively, which depends on the stray rate $m$.
The partial derivative in the Eq. \ref{eq:mu} determines how the mean trait changes through time due to natural selection (REF), which is proportional to the change in mean fitness with respect to $\mu_i$.




%Density dependent m
We have so far assumed that the proportion of strays leaving and entering a population is constant, however there is good evidence that at least in some species the stray rate is density dependent.
Specifically, the rate at which individuals stray has been linked directly to a collective decision-making phenomenon, where greater numbers of individuals tends to decrease the rate at which individuals stray, thus reducing the overall proportion of a population that strays.
According to REF, given the probability that an individual strays $m_0$, the proportion of the local population $N_i(t)$ that strays is

\begin{equation}
  m(t) = m_0\left(1- \frac{N_i(t)}{C+N_i(t)}\right),
  \label{eq:ddm}
\end{equation}

\noindent where $C$ is the half-saturation value of $N_i$ where the density-dependent stray rate decreases sharply.
We note that at the limit $C\rightarrow \infty$, the density dependent stray rate becomes constant such that $m(t) \rightarrow m_0$, and this corresponds to the original formulation where $m=m_0$.
A similar observation shows that when the population density is very high, $m(t) \rightarrow 0$, and when it is close to extinction, $m(t) \rightarrow m_0$.
Thus, for realistic population densities, $m(t) < m_0$.


%Linking m/m0 and thetadiff
Stray rate is intrinsically linked to the distance between the local and straying population.
The greater the distance between two populations, the lower the expected rate of straying (REF).
We can account for this interdependence in our model by assuming that $m$ (if the stray rate is constant) or $m_0$ (if the stray rate is density dependent) is a function of $theta_i-theta_j$, which can be assumed to be large if the remote site $j$ is a great distance away from the local site $i$.
If sites $i$ and $j$ are very close, the stray rate is assumed to maximized at $m,m_0 = 0.5$.
Thus, we can integrate these two variables by setting $m,m_0 = (2 + \epsilon (\theta_i-\theta_j))^{-1}$, where $\epsilon$ sets the sensitivity of a declining $m$ to increasing distance (greater values of $\theta_i-\theta_j$).



\section*{Results}

%The effects of trait evolution :: trait heritability, trait variance, and habitat heterogeneity
%% Bifurcation to alternative stable state occurs at higher stray rates with increased trait heritability
%% There is a peak in the portfolio effect directly before this bifurcation is crossed (early warning signal), and then a decline in PE with high m
%% When trait heritability is high, there is a greater sensitivity of total biomass to increasing stray rates, though a LOWER sensitivity of the difference between alternative steady state values for increasing stray rates (and vice versa)
%% For low heritability (h = 0.01 - 0.2 or so), moderate and insensitive changes in total biomass, but large differences between the values of alternative steady states leads to a local maximum for PE at low-moderate stray rates



%Alternative stable states
{\bf Nonlinear effects of straying on the Portfolio Effect} Straying generally lowers steady state densities for both local and remote populations. %, regardless of trait heritability and variance or habitat heterogeneity
The decline in steady state densities is not gradual: as straying increases, the system crosses a fold bifurcation whereby the single steady state among both sites becomes two alternative steady states: one at high biomass density, and one at low biomass density (Fig. \ref{fig:traj}A,B).
This bifurcation occurs at lower values of the stray rate $m$ for low trait heritability $h^2$ (Fig \ref{fig:PE}A), indicating that greater coupling between ecological and evolutionary dynamics in addition to greater rates of straying results in alternative stable states among the two sites.

Trait heritability also has a large impact on the sensitivity of both the total steady state density ($N^*_T=N^*_1+N^*_2$) as well as the difference between steady state densities ($\Delta N=\sqrt{(N^*_1-N^*_2)^2}$).
Greater trait heritability results in a larger decline in $N_T^*$ for increasing stray rates $m$, though results in only moderate changes to $\Delta N$ (Figs. \ref{fig:PE}A,B).
Conversely, if the trait is less heritable, an increase in the stray rate has little impact on the total biomass density and contrastingly large effects on the difference in population densities between sites (Fig. \ref{fig:PE}A,B).

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{figs/fig_thetaPE.pdf}
\caption{
Median portfolio effect as a function of stray rate $m$ for lower trait heritability ($h^2 < 0.5$).
Vertical dashed lines represent the fold bifurcation, which occurs at lower stray rates with increased habitat heterogeneity $\Delta \theta$.
} \label{fig:thetaPE}
\end{figure}



Together these changes in steady state population densities in terms of $N_T$ and $\Delta N$ as a function of trait heritability and the rate of straying between populations give rise to highly nonlinear portfolio effects, quantified here as

\begin{equation}
  {\rm PE} = \frac{\overline{{\rm CV}}_{i,j}}{{\rm CV}_T}.
  \label{eq:pe}
\end{equation}

\noindent We define $\overline{{\rm CV}}_{i,j}$ as the average coefficient of variation across the local population $i$ and the remote population $j$ at steady state densities, and ${\rm CV}_T$ as the coefficient of variation of the total or aggregated population at steady state densities.
The minimum portfolio effect is by definition ${\rm PE_min}=1$, whereas portfolio effects greater than unity corresponds to a greater potential for ecological rescue among populations, thus buffering the system as a whole against extinction. 


In the region where there is a single steady state among both populations, we find a correspondingly high portfolio effect, primarily due to the elevated mean values of $N_T$.
As the fold bifurcation is approached with greater rates of straying, the portfolio effect spikes due to a large increase in the standard deviation of both populations.
This explosion in variance is a well-known phenomenon that occurs near a fold bifurcation and lies at the heart of early warning signal theory (REFS).
For larger values of $m$ (to the right of the fold bifurcation in Fig \ref{fig:PE}C), where there is a high and low steady state density among the sites, if heritability is low the portfolio effect becomes minimized, is elevated and then declines as $m\rightarrow 0.5$.
If heritability is high, the portfolio effect declines steadily after the explosion in variance associated with the development of alternative stable states.
% As the stray rate increases to the right of the bifurcation, increased trait heritability results in a steady decrease in the portfolio effect.
% If trait heritability is low, the portfolio effect is nonlinear over increasing stray rates: after the spike associated with the fold bifurcation, {\rm PE} first increases at intermediate stray rates and then declines as $m\rightarrow0.5$. 

%Lowering Phenotypic diversity with increasing straying rate
As expected, increasing rates of straying lowers phenotypic diversity because both local and remote populations become homogenized.
The sensitivity of this phenotypic homogenization to straying rate is increased with lower heritability because the selective forces acting against trait means far from local optima is lessened for lower $h^2$.
[A DISCRETE JUMP TO LOW DIVERSITY FOR LOW HERITABILTIY](Fig. \ref{fig:traitdiff}).

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{figs/fig_traitdiff.pdf}
\caption{
} \label{fig:traitdiff}
\end{figure}

% Density dependent m
%% Because m[t] @ steady state 0<m[t]<m0, we observe the same dynamics for higher m0 as we do for lower constant m.
%% Higher rates of straying are tolerable (there is a not a decline in PE for very high m0 as there is for constant m)
If we assume that the rate of straying is density dependent, the probability of straying at the individual level $m_0$ determines the rate of straying within the population, such that $m(t)$ becomes lower as $N(t)$ increases.
At steady state values, $m(t)$ also becomes constant, though by definition is always less than $m_0$, such that $0 < m(t) < m_0$.
We find that this dynamic has negligible impact on the qualitative results on our system (Fig. \ref{fig:diffddm}, Appendix Fig. \ref{fig:ddm}).
Quantitatively, density dependent straying serves to lessen the effect of straying on $N_T$, $\Delta N$ and PE, given that the effective stray rate is effectively lessened by collective navigation.
%Because density dependent straying does not alter that qualitative results of our model, we limit additional analyses 


 
 
%% Increased habitat heterogeneity
  %%% 1) exaggerates lowering of mean biomass with increasing stray rates
  %%% 2) increases the likelihood of alternative stable sites & increases the differences in alternative stable state values with increasing stray rates
  %%% 3) decreases the PE (!!)
{\bf The role of habitat heterogeneity} Increased differences in optimal trait values between sites ($\Delta\theta = \left|\theta_i - \theta_j\right|$) corresponds to greater between-site differences in conditions that favor alternative physiologies, interpreted here as increased habitat heterogeneity.
At one end of the spectrum, if both populations are isolated, natural selection would direct the mean trait values of both populations towards their respective optima, such that $\mu_i(t) \rightarrow \theta_i$ as $t\rightarrow\infty$.
%difference in optimal trait values between the local and remote populations, which we call .
However when straying exists, we find that increasingly divergent trait optima generally lowers $N_T$ and exaggerates $\Delta N$, such that one population has the majority of the biomass (Appendix Fig. \ref{fig:thetadiff1},\ref{thetadiff2}).
The impact of habitat heterogeneity on the portfolio effect is more complex, serving to emphasize the nonlinear relationship between the stray rate and the PE, regardless of heritability.
%The rate of straying that gives rise to a large PE at the fold bifurcation is conditioned on the difference in optimal trait values between the local and remote populations, which we call $\Delta\theta = \sqrt{(\theta_i - \theta_j)^2}$.
The extent of the nonlinearity between $m$ and the PE depends very much on $\Delta\theta$, particularly when trait heritability is low ($h^2<0.5$).
As habitat heterogeneity increases, the fold bifurcation and associated spike in PE generally occurs for lower values of stray rates, meaning that a lower amount of straying can give rise to alternative stable states (Fig. \ref{fig:thetaPE}).
In the region where alternative stable states are feasible (Fig. \ref{fig:thetaPE}), additional straying increases the portfolio effect to a local maximum before its negative effects serve to lower PE as $m\rightarrow 0.5$, and this effect is exaggerated with increasing habitat heterogeneity.



\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{figs/fig_diffddm.pdf}
\caption{
Difference in PE for simulations with a constant stray rate $m$ and PE for simulations with a density dependent stray rate $m(t)$. The differences are minimal (mean difference in PE = -0.05) and result in no discernible qualitative difference in dynamics, though density dependent stray rates generally amplify PE.
} \label{fig:diffddm}
\end{figure}

\begin{figure*}
  \centering
  \includegraphics[width=0.8\textwidth]{figs/fig_MDPE_hm_mtheta.pdf}
  \caption{
  Assuming that the rate of straying is linked directly to habitat heterogeneity. A low stray rate corresponds to very different (or distant) habitats (high $\Delta\theta$), whereas a higher rate of straying corresponds to very similar (or nearby) habitats (low $\Delta\theta$). Light colors = high values.
  } \label{fig:mtheta}
\end{figure*}



% When m and thetadiff are linked
%%Constant m
  %%% Low stray rate (high theta1-theta2) leads to alternative stable states and relatively low PE ~ sharp transition
  %%% High stray rate (low theta1-theta2) increases the steady state (and no A.S.S.)... 
  %%% This suggests that space naturally buffers against the negative effects of mixing dissimilar populations, however it is NOT SMOOTH
  %%% This is particularly true for low heritability. High heritability eliminates the A.S.S. region
  %%% (!!!) Even low levels of straying from distant populations can result in highly divergent alternative steady states! THIS IS A COOL RESULT





{\bf Linking stray rate and habitat heterogeneity} We have so far treated $\Delta\theta$ and $m$ as independent parameters, however we may also assume that if environmental heterogeneity increases with distance, the rate of straying may be expected to decline given that individuals are less likely to stray into distant habitats. %-- in particular North-South difference if trait optimality is largely temperature-dependent --
If we incorporate this interdependence of $m$ and $\Delta\theta$, low rates of straying would correspond to mixing dissimilar (distant) populations, and high rates of straying would correspond to mixing similar (nearby) populations.

Here we find that alternative stable states now appear for low stray rates and over any value of trait heritability $h^2<1$.
As stray rates increase, a single stable state emerges with a correspondingly high $N_T$.
As before, there is a spike in the PE at the fold bifurcation separating the alternative stable state regime from the single stable state regime, and a sharp decline in the PE as stray rates become very low.
This is in accordance with intuition as increasing stray rates mean that two very similar populations are mixing, resulting in little negative effect of trait dissimilarity.

That alternative stable states appear and that PE becomes severely depressed for very low rates of straying is surprising: this means that even a small amount of mixing of populations from distant or dissimilar populations can qualitatively alter the dynamics of the metapopulation, regardless of trait heritability.
%(for the discussion: an example of this situation may be the salmon populations during the last glacial maximum, where any mixing would be from geographically distant populations)


\section*{Discussion}

We have shown that the natural selection of mixed populations adapted to different environments can result in large effects on population dynamics and the degree to which the metapopulation is buffered against extinction, which we quantify as the portfolio effect.
The inclusion of individuals with trait values far from the local optimum generally lowers the combined steady state biomass $N_T$ and increases the likelihood that the system gives way to alternative steady states, pushing one of the populations close to extinction.
Although the emergence of alternative steady states can result in very large portfolio effects near the bifurcation, alternative steady state regimes tend to result in very low portfolio effects, indicating that the metapopulation is less likely to persist.

The degree to which the PE is lowered depends to a large extent on \emph{i}) trait heritability $h^2$ and \emph{ii}) habitat heterogeneity $\Delta \theta$.
Increased heritability means that the effects of natural selection on the metapopulation are larger, increasing the coupling between evolutionary and ecological dynamics. 
Our minimal model of straying between two populations shows that greater $h^2$ buffers the metapopulation against the emergence of alternative stable states for lower stray rates, but magnifies the negative effects of alternative stable states (captured by increased $\Delta N$ and decreased PE; Fig. \ref{fig:PE}B,C) once this regime is encountered at higher stray rates.
Although the rate of straying has been shown to be density dependent (REFS), the qualitative results of our model are relatively insensitive to this dynamic and we limit discussion to the simplified case of a constant stray rate $m$ with the understanding that our findings also apply to the case density dependent stray rates $m(t)$.

%Our results in the context of Turing bifurcation
The onset of alternative stable states in a spatial context describes the emergence of spatial pattern formation (REFS), which is more generally defined as a Turing instability (REFS).
The mathematical conditions that lead to Turing instabilities are well-known in both continuous (REFS) and discrete spatial contexts (REFS)


%North-South vs East-West


\clearpage
\setcounter{figure}{0}
\section*{Appendix}


\begin{figure*}[h!]
\centering
\begin{subfigure}[t]{0.55\textwidth}
\centering
\includegraphics[width=\textwidth]{figs/fig_MDPE_hm_theta3.pdf} 
\caption{Low habitat heterogeneity ($\Delta\theta=3$)} \label{fig:thetadiff1}
\end{subfigure}
\begin{subfigure}[t]{0.55\textwidth}
\centering
\includegraphics[width=\textwidth]{figs/fig_MDPE_hm_theta8.pdf} 
\caption{High habitat heterogeneity ($\Delta\theta=8$)} \label{fig:thetadiff2}
\end{subfigure}
\caption{Total means $N_t$, difference in means $\Delta N$, and the portfolio effect PE for different habitat heterogeneities $\Delta\theta$. Light colors = high values.
}
\end{figure*}


\begin{figure*}[h!]
\centering
\includegraphics[width=0.8\textwidth]{figs/fig_MDPE_hm_ddm.pdf}
\caption{
The same simulations as presented in Figure \ref{fig:PE}, except with density dependent straying, where $m(t) = m_0\left(1-N(t)/(C+N(t)\right)$. Light colors = high values.
} \label{fig:ddm}
\end{figure*}


\end{document}
